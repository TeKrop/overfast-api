init_worker_by_lua_block {
  prometheus = require("prometheus").init("prometheus_metrics")
  metric_requests = prometheus:counter("nginx_http_requests_total",
    "Total HTTP requests", {"endpoint", "method", "status", "cache"})
  metric_latency = prometheus:histogram("nginx_http_request_duration_seconds",
    "Request latency", {"endpoint"}, {0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1.0, 2.5, 5.0, 10.0})
  metric_connections = prometheus:gauge("nginx_connections",
    "Active connections", {"state"})
  metric_unknown_player_rejections = prometheus:counter("unknown_player_rejections_total",
    "Early rejections for unknown players served from Valkey cooldown cache")
}